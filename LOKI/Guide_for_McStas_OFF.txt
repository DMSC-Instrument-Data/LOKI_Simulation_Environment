# HOW TO SETUP MCSTAS FOR MANTID 
# Install McStas 
# Install NeXus
# Install Mantid (nightly build)
#  
# We need latest version of McStas
# copy file monitors/Monitor_nD.comp from github to local folder
# https://github.com/McStasMcXtrace/McCode/blob/master/mcstas-comps/monitors/Monitor_nD.comp
# or rebuild McStas your self



# HOW TO RUN SIMULATION
# 
# Make OFF file for McStas 
python mcstas_off_generator.py 
cp tri7.off LoKI_4mm.off 

# Compile McStas instr file
mcstas templateSANS_Mantid.instr --trace

# Make IDF for Mantid
mcdisplay templateSANS_Mantid.instr --format=Mantid -n0 offfile=LoKI_4mm.off

# Compile McStas c-code with NeXus libs
gcc -std=c99 -o templateSANS_Mantid.out templateSANS_Mantid.c -lm -DUSE_NEXUS -lNeXus

# Run single core simulation
./templateSANS_Mantid.out --format=NeXus offfile=LoKI_4mm.off 


# MPI simulation are done as follows:
# Compile McStas c-code with NeXus libs
mpicc -std=c99 -o templateSANS_Mantid.out templateSANS_Mantid.c -lm -DUSE_NEXUS -lNeXus -DUSE_MPI

# Run singel core simulation
mpirun -np 2 ./templateSANS_Mantid.out --format=NeXus offfile=LoKI_4mm.off


# Mantid reduction
# a) Load McStas NeXus file
# b) Run Mantid algorithm: 'ConvertUnits' using the 'wavelenth' and 'elastic' options
# c) Run Mantid algorithm: 'Qxy' using the options 'MaxQxy=0.6', 'DeltaQ=0.003', 'SolidAngleWeighting=False'




